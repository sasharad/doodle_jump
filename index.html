<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <script src="https://code.jquery.com/jquery-2.1.0.js"></script>

    <canvas id="canvas" width="500" height="500"></canvas>

    <script>
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");
        var width = canvas.width;
        var height = canvas.height;

        const colors = ['#2185C5', '#7ECEFD', '#FF7F66']
    
        var proccess = true

        var ballUp = 0;

        var bottom = height;

        var toppi = 100;

        var direction = 0

        var Ball = function(){
            this.x = width / 2;
            this.y = height - 10;
            this.speedX = 0;
            this.speedY = 1;
            this.radius = 5;
            this.gravity = 0.2;  
            this.gravitySpeed = 0;
        }

        var Block = function(x, y){
            this.x = x;
            this.y = y;    
            this.width = 100;
            this.height = 10 ;   
        }

       var Block = function (x, y) {
           this.x = x;
           this.y = y;
           this.width = 100;
           this.height = 10;
       }
        

        var circle = function (x, y, radius, filin) {
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2, false);
                if (filin) {
                    ctx.fill();
                } else {
                    ctx.stroke();
                }
            }

        var drawBorder = function () {
            ctx.strokeRect(0, 0, width, height);
        }

        var timeoutId = function () {
            if (proccess) {
                setTimeout(gameLoop, 1);
            }
        }

        var goUp = function () {
            ball.y = ball.y / 2;
            
        }

        function distance(x1, y1, x2, y2) {
            const xDist = x2 - x1
            const yDist = y2 - y1
            return Math.sqrt(Math.pow(xDist, 2) + Math.pow(yDist, 2))
        }

        function acceleration(n) {
            ball.gravity = n
        }

        Ball.prototype.draw = function () {
            ctx.fillStyle = "blue";
            circle(this.x, this.y, this.radius, true);
        }

        Block.prototype.draw = function () {
            ctx.fillStyle = "Black";
            ctx.fillRect(this.x, this.y, this.width, this.height);
        }

        Ball.prototype.move = function(){
            this.gravitySpeed += this.gravity;
            this.x += this.speedX;
            this.y += this.speedY + this.gravitySpeed;

            if (this.y + this.radius > bottom) {
                this.y -= this.radius;
                this.gravitySpeed = 0;
                acceleration(-0.12);
            }

            if (this.y < height - toppi) {
                acceleration(0.1);                                    
            }

            if (this.x + this.radius > width) {
                this.x -= this.speedX;  
            }

            if (this.x - this.radius < 0) {
                this.x -= this.speedX;                
            }

            if (direction === 0) {
                this.speedX = 0;
            }

            if (direction === 1) {
                this.speedX = -5;
                direction = 0;
            }

            if (direction === 3) {
                this.speedX = 5;
                direction = 0;
            }
        }

        Ball.prototype.checkcollision = function(){
            for (var i = 0; i < block.width; i++) {
                if (distance(this.x - i, this.y - 2, block.x, block.y) < 2) {
                    bottom = this.y + 3; 
                    toppi =200;
                }
            }   
            if (this.x < block.x && this.y > block.y - 5) { 
                    bottom = height;
                    toppi = 100;
            }
            if (this.x > block.x + block.width && this.y > block.y - 5) {
                    bottom = height;
                    toppi = 100;
            } 


            for (var i = 0; i < block.width; i++) {
                if (distance(this.x - i, this.y - 2, block1.x, block1.y) < 2) {
                    bottom = this.y + 3;
                    toppi = 350;
                } 
            } 
            if (this.x < block1.x && this.y > block1.y - 5 && this.y < block1.y + 5) {
                    bottom = height;
                    toppi = 100;
            }
            if (this.x > block1.x + block1.width && this.y > block1.y - 5 && this.y < block1.y + 5) {
                    bottom = height;
                    toppi = 100;
            } 


            for (var i = 0; i < block.width; i++) {
                if (distance(this.x - i, this.y - 2, block2.x, block2.y) < 2) {
                    bottom = this.y + 3;
                    toppi = 490;
                }
            }
            if (this.x < block2.x && this.y > block2.y - 5 && this.y < block2.y + 5) {
                bottom = height;
                toppi = 100;
            }
            if (this.x > block2.x + block2.width && this.y > block2.y - 5 && this.y < block2.y + 5) {
                bottom = height;
                toppi = 100;
            } 
        }

        ball = new Ball();
        block1 = new Block(150, 250); 
        block = new Block(200, 350);
        block2 = new Block(220, 100) 

        function gameLoop() {
            ctx.clearRect(0, 0, width, height);
            drawBorder();
            ball.move();
            ball.draw();
            block.draw();
            block1.draw();
            block2.draw();
            ball.checkcollision();
            timeoutId();
        }

        gameLoop()

        $("body").keydown(function (event) {
            direction = keyActions[event.keyCode]
        })

        var keyActions = {
            37: 1, //left
            38: 2, // up
            39: 3 // right
        };
    </script>

</body>
</html>